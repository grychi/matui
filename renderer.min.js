'use strict';var ById=function(a){return document.getElementById(a)},matuiDir='file:///'+__dirname+'/pages/',jsonfile=require('jsonfile'),favicon=require('favicon-getter').default,path=require('path'),uuid=require('uuid'),bookmarks=path.join(__dirname,'bookmarks.json'),homeURL='https://www.google.com/',currentZoom=6,zooms=[25,33,50,67,75,90,100,110,125,150,175,200,250,300],currentView,listViews=[],searchEngines=['https://www.google.com/search?&q='],searchAPI=['https://api.bing.com/osjson.aspx?query='],searchTimer,prevSearch='',Bookmark=function(a,b,c){this.url=a,this.icon=b,this.title=c};Bookmark.prototype.ELEMENT=function(){var a=document.createElement('a');a.href=this.url,a.className='link',a.textContent=this.title;var b=document.createElement('img');return b.src=this.icon,b.className='favicon',a.insertBefore(b,a.childNodes[0]),a},function(){function a(){function c(){const Ea=b.getCurrentWindow();Ea.close()}function d(Ea){'string'!=typeof Ea&&(Ea=matuiDir+'new.html');var Fa=uuid.v1();listViews.push(Fa);var Ga='<webview id="view-'+Fa+'" class="page" src="'+Ea+'" useragent="Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 matui/1.0.0" autosize="on"></webview>',Ha='<div id="tab-'+Fa+'" class="oneTab"><div id="icon-'+Fa+'" class="icon-insert"><i class="material-icons">note</i></div><div id="'+Fa+'"class="closeTab"></div></div>';Aa.insertAdjacentHTML('beforeend',Ga),W.insertAdjacentHTML('beforeend',Ha),currentView='view-'+Fa,Ba=ById(currentView),document.getElementById('tab-'+Fa).addEventListener('click',g),document.getElementById(Fa).addEventListener('click',function(Ia){if(Ia.stopPropagation(),1==listViews.length)c();else{var Ja=document.getElementById('view-'+Fa);Aa.removeChild(Ja);var Ka=document.getElementById('tab-'+Fa);W.removeChild(Ka);var La=listViews.indexOf(Fa);listViews.splice(La,1),g(listViews[listViews.length-1])}}),f()}function f(){var Ea=document.getElementById('view-'+listViews[listViews.length-1]);Ea.addEventListener('new-window',function(Fa){const Ga=require('url').parse(Fa.url).protocol;('http:'===Ga||'https:'===Ga)&&d(Fa.url),C()}),Ea.addEventListener('page-favicon-updated',function(Fa){var Ga=Ea.id.substring(5,Ea.id.length);if(0<Fa.favicons.length){var Ha=Fa.favicons[Fa.favicons.length-1];document.getElementById('icon-'+Ga).innerHTML='<div style="background-image: url('+Ha+')" class="tabIcon"></div>'}else document.getElementById('icon-'+Ga).innerHTML='<i class="material-icons">note</i>'}),g()}function g(Ea){var Fa=document.getElementsByClassName('activeTab');if(null==Ea||null!=this.id||0==Fa.length){for(var Ga=0;Ga<Fa.length;Ga++){var Ha=Fa[Ga].id.substring(4,Fa[Ga].id.length),Ia=document.getElementById('view-'+Ha);Ia.style.visibility='hidden',Ia.removeEventListener('did-finish-load',C),Ia.removeEventListener('did-frame-finish-load',C),Ia.removeEventListener('page-title-updated',D);var Ja=Fa[Ga].className.substring(0,Fa[Ga].className.length-10);Fa[Ga].className=Ja}if(null!=this){this.className+=' activeTab';var Ka=this.id.substring(4,this.id.length);document.getElementById('view-'+Ka).style.visibility='visible',currentView='view-'+Ka,Ba=ById(currentView),D()}else if(null==Ea)document.getElementById('tab-'+listViews[listViews.length-1]).className+=' activeTab';else if(null!=Ea)document.getElementById('tab-'+Ea).className+=' activeTab',document.getElementById('view-'+Ea).style.visibility='visible',currentView='view-'+Ea,Ba=ById(currentView),D();else{let La=listViews[listViews.length-1];document.getElementById('tab-'+La).className+=' activeTab',document.getElementById('view-'+La).style.visibility='visible',currentView='view-'+La,Ba=ById(currentView),D()}Ba.addEventListener('did-finish-load',C),Ba.addEventListener('did-frame-finish-load',C),Ba.addEventListener('page-title-updated',D),C()}}function h(){var Ea=document.getElementById('browser-menu');Ea.style.display='none'==Ea.style.display?'block':'none'}function r(){var Ea='';Ea+=zooms[currentZoom]+'%',ja.innerHTML=Ea}function y(){h();let Fa=xa.getAttribute('data-state');'closed'===Fa?(E(),ya.innerHTML='',jsonfile.readFile(bookmarks,function(Ga,Ha){if(0!==Ha.length)for(var Ia=0;Ia<Ha.length;Ia++){let Ja=Ha[Ia].url,Ka=Ha[Ia].icon,La=Ha[Ia].title;20<La.length&&(La=La.substring(0,20),La+=' ...');let Ma=new Bookmark(Ja,Ka,La),Na=Ma.ELEMENT();ya.appendChild(Na)}xa.style.display='block',xa.setAttribute('data-state','opened')})):(xa.style.display='none',xa.setAttribute('data-state','closed'))}function C(){document.activeElement!=U&&(matuiDir=matuiDir.split('\\').join('/'),U.value=Ba.src.includes(matuiDir)?'matui://'+Ba.src.substring(matuiDir.length,Ba.src.length-5):Ba.src),va.innerHTML='<div class="suggestionItem" style="font-style: italic;"> Type to search or enter an address </div>'}function D(Ea){var Fa;Fa=Ea?Ea.title:Ba.getTitle(),document.title=Fa,V.innerHTML=Fa}function E(){Ca.style.display='block'}function H(Ea){var Fa=document.createElement('div');Fa.className+='suggestionItem',Fa.tabIndex=0,Fa.innerHTML=Ea,Fa.addEventListener('click',J),Fa.addEventListener('keyup',J),va.appendChild(Fa)}function I(){var Ea=U.value.trim();prevSearch=Ea;const Fa=require('url').parse(Ea).protocol;let Ga=Ea.slice(0,8).toLowerCase();if(''==Ea||'http:'===Fa||'https:'===Fa||'matui://'===Ga)return void(va.innerHTML='<div class="suggestionItem" style="font-style: italic;"> Type to search or enter an address </div>');Ea=encodeURIComponent(Ea),va.innerHTML='';var Ha=new XMLHttpRequest;Ha.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var Ia=JSON.parse(this.responseText);if(Ia[0])for(var Ka,Ja=0;Ja<Ia[1].length&&3>Ja;Ja++)Ka=Ia[1][Ja],H(Ka)}},Ha.open('GET',searchAPI[0]+Ea,!0),Ha.send()}function J(Ea){if('click'==Ea.type||'keyup'==Ea.type&&13==Ea.keyCode){let Fa=this.innerHTML;Ba.loadURL(searchEngines[0]+Fa),va.style.display='none',Ca.style.display='none'}else'keyup'==Ea.type&&40==Ea.keyCode?K('next'):'keyup'==Ea.type&&38==Ea.keyCode&&K('prev')}function K(Ea='next'){var Fa=document.getElementsByClassName('suggestionItem'),Ga;for(Ga=0;Ga<Fa.length&&Fa[Ga]!=document.activeElement;Ga++);'next'==Ea&&++Ga<Fa.length?(document.activeElement.blur(),Fa[Ga].focus()):'prev'==Ea&&0<=--Ga&&(document.activeElement.blur(),Fa[Ga].focus())}function L(Ea){switch(h(),Ea){case'bookmarks':var Fa=document.getElementById('browser-menu');Fa.style.display='none',d(matuiDir+'bookmarks.html');break;case'downloads':d(matuiDir+'downloads.html');break;case'history':d(matuiDir+'history.html');break;case'settings':d(matuiDir+'settings.html');break;case'feedback':d(matuiDir+'feedback.html');break;case'about':d(matuiDir+'about.html');break;default:d();}}var O=ById('min-btn'),P=ById('max-btn'),Q=ById('close-btn'),R=ById('menu'),S=ById('back'),T=ById('protocol'),U=ById('url'),V=ById('viewTitle'),W=ById('tabs'),X=ById('newTab'),Y=ById('forward'),Z=ById('refresh'),$=ById('home'),_=ById('fave'),aa=ById('private'),ba=ById('block'),ca=ById('list'),da=ById('downloads'),ea=ById('history'),fa=ById('find'),ga=ById('print'),ha=ById('zoom-in'),ia=ById('zoom-out'),ja=ById('zoom-level'),ka=ById('fullscreen'),la=ById('pinned'),ma=ById('theme'),na=ById('cut'),oa=ById('copy'),pa=ById('paste'),qa=ById('console'),ra=ById('settings'),sa=ById('feedback'),ta=ById('about'),ua=ById('exit'),va=ById('suggestions'),wa=ById('permissions'),xa=ById('fave-popup'),ya=ById('bmarks'),za=ById('fave-manage'),Aa=ById('views'),Ba=ById(currentView),Ca=ById('viewOverlay'),Da=ById('contextMenu');d(homeURL),O.addEventListener('click',function(){const Fa=b.getCurrentWindow();Fa.minimize()}),P.addEventListener('click',function(){const Fa=b.getCurrentWindow();Fa.isMaximized()?Fa.unmaximize():Fa.maximize()}),Q.addEventListener('click',c),R.addEventListener('click',h),X.addEventListener('click',d),S.addEventListener('click',function(){Ba.goBack()}),U.addEventListener('keyup',function(Ea){if(13===Ea.keyCode){U.blur();let Ga=U.value.trim(),Ha=Ga.slice(0,8).toLowerCase(),Ia=Ga.slice(0,7).toLowerCase();'https://'===Ha||'http://'===Ia?Ba.loadURL(Ga):'matui://'==Ha?Ba.loadURL(matuiDir+Ga.substring(8,Ga.length)+'.html'):!Ga.includes('.')||Ga.includes(' ')?(Ga=encodeURIComponent(Ga),Ba.loadURL(searchEngines[0]+Ga)):Ba.loadURL('http://'+Ga),va.style.display='none',Ca.style.display='none'}else if(40===Ea.keyCode){U.blur();var Fa=document.getElementsByClassName('suggestionItem');0<Fa.length&&Fa[0].focus()}}),U.addEventListener('keyup',function(){clearTimeout(searchTimer),U.value.trim()!=prevSearch&&(searchTimer=setTimeout(I,500))}),V.addEventListener('click',function(){U.focus(),U.select(),va.style.display='block',E()}),Y.addEventListener('click',function(){Ba.goForward()}),Z.addEventListener('click',function(){Ba.reload()}),$.addEventListener('click',function(){Ba.loadURL(homeURL)}),_.addEventListener('click',function(){let Ea=Ba.src,Fa=Ba.getTitle();favicon(Ea).then(function(Ga){let Ha=new Bookmark(Ea,Ga,Fa);jsonfile.readFile(bookmarks,function(Ia,Ja){Ja.push(Ha),jsonfile.writeFile(bookmarks,Ja,function(){})})})}),ca.addEventListener('click',y),da.addEventListener('click',function(){L('downloads')}),ea.addEventListener('click',function(){L('history')}),ga.addEventListener('click',function(){Ba.print()}),ha.addEventListener('click',function(){currentZoom<zooms.length-1&&(Ba.setZoomFactor(zooms[++currentZoom]/100),r())}),ia.addEventListener('click',function(){0<currentZoom&&(Ba.setZoomFactor(zooms[--currentZoom]/100),r())}),la.addEventListener('click',function(){const Fa=b.getCurrentWindow();let Ga=la.getAttribute('data-state');'notPinned'===Ga?(la.innerHTML='<i class="material-icons">radio_button_checked</i> <div class="menu-description">Unpin browser</div>',Fa.setAlwaysOnTop(!0),la.setAttribute('data-state','isPinned')):(la.innerHTML='<i class="material-icons">radio_button_unchecked</i> <div class="menu-description">Pin browser</div>',Fa.setAlwaysOnTop(!1),la.setAttribute('data-state','notPinned'))}),ma.addEventListener('click',function(){let Fa=ma.getAttribute('data-state');'light'===Fa?(ma.innerHTML='<i class="material-icons">brightness_2</i> <div class="menu-description">Dark theme</div>',document.body.className+='dark-theme',ma.setAttribute('data-state','dark')):(ma.innerHTML='<i class="material-icons">brightness_5</i> <div class="menu-description">Light theme</div>',document.body.className='',ma.setAttribute('data-state','light'))}),na.addEventListener('click',function(){Ba.cut()}),oa.addEventListener('click',function(){Ba.copy()}),pa.addEventListener('click',function(){Ba.pasteAndMatchStyle()}),qa.addEventListener('click',function(){Ba.isDevToolsOpened()?Ba.closeDevTools():Ba.openDevTools()}),ra.addEventListener('click',function(){L('settings')}),sa.addEventListener('click',function(){L('feedback')}),ta.addEventListener('click',function(){L('about')}),ua.addEventListener('click',c),xa.addEventListener('click',function(Ea){'link'===Ea.target.className?(Ea.preventDefault(),d(Ea.target.href)):'favicon'===Ea.target.className&&(Ea.preventDefault(),d(Ea.target.parentElement.href))}),za.addEventListener('click',function(){L('bookmarks')}),Ca.addEventListener('click',function(){'closed'!=xa.getAttribute('data-state')&&y();var Ea=document.getElementById('browser-menu');Ea.style.display='none',va.style.display='none',Ca.style.display='none'}),document.addEventListener('contextmenu',function(Ea){E(),Da.style.display='block',Da.style.top=Ea.clientY+'px',Da.style.left=Ea.clientX+'px'}),document.addEventListener('click',function(Ea){for(var Fa=Ea.target;Fa!=document.body&&Fa!=Da;)Fa=Fa.parentElement;Fa!=Da&&(Da.style.display='none')})}const b=require('electron').remote;document.onreadystatechange=function(){'complete'==document.readyState&&a()}}();