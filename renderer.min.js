'use strict';var ById=function(a){return document.getElementById(a)},matuiDir='file:///'+__dirname+'/pages/',jsonfile=require('jsonfile'),favicon=require('favicon-getter').default,path=require('path'),uuid=require('uuid'),bookmarks=path.join(__dirname,'bookmarks.json'),homeURL='https://www.google.com/',currentZoom=6,zooms=[25,33,50,67,75,90,100,110,125,150,175,200,250,300],currentView,listViews=[],searchEngines=['https://www.google.com/search?&q=','https://www.bing.com/search?q=','https://www.ecosia.org/search?q=','https://duckduckgo.com/?q=','http://www.wolframalpha.com/input/?i=','https://search.aol.com/aol/search?q='],searchAPI=['https://api.bing.com/osjson.aspx?query=','http://api.duckduckgo.com/?q= INSERT_QUERY &format=json'],searchTimer,prevSearch='',Bookmark=function(a,b,c){this.url=a,this.icon=b,this.title=c};Bookmark.prototype.ELEMENT=function(){var a=document.createElement('a');a.href=this.url,a.className='link',a.textContent=this.title;var b=document.createElement('img');return b.src=this.icon,b.className='favicon',a.insertBefore(b,a.childNodes[0]),a},function(){function a(){function c(){var Da=b.getCurrentWindow();Da.close()}function d(Da){'string'!=typeof Da&&(Da=matuiDir+'new.html');var Ea=uuid.v1();listViews.push(Ea);var Fa='<webview id="view-'+Ea+'" class="page" src="'+Da+'" useragent="Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 matui/1.0.0" autosize="on"></webview>';za.insertAdjacentHTML('beforeend',Fa),V.insertAdjacentHTML('beforeend','\n            <div id="tab-'+Ea+'" class="oneTab">\n                <div id="icon-'+Ea+'" class="icon-insert">\n                    <i class="material-icons">note</i>\n                </div>\n                <div id="'+Ea+'"class="closeTab"></div>\n            </div>'),currentView='view-'+Ea,Aa=ById(currentView),document.getElementById('tab-'+Ea).addEventListener('click',g),document.getElementById(Ea).addEventListener('click',function(Ha){if(Ha.stopPropagation(),1==listViews.length)c();else{var Ia=document.getElementById('view-'+Ea);za.removeChild(Ia);var Ja=document.getElementById('tab-'+Ea);V.removeChild(Ja);var Ka=listViews.indexOf(Ea);listViews.splice(Ka,1),g(listViews[listViews.length-1])}}),f()}function f(){var Da=document.getElementById('view-'+listViews[listViews.length-1]);Da.addEventListener('new-window',function(Ea){var Fa=require('url').parse(Ea.url).protocol;('http:'===Fa||'https:'===Fa)&&d(Ea.url),C()}),Da.addEventListener('page-favicon-updated',function(Ea){var Fa=Da.id.substring(5,Da.id.length);if(0<Ea.favicons.length){var Ga=Ea.favicons[Ea.favicons.length-1];document.getElementById('icon-'+Fa).innerHTML='<div style="background-image: url('+Ga+')" class="tabIcon"></div>'}else document.getElementById('icon-'+Fa).innerHTML='<i class="material-icons">note</i>'}),g()}function g(Da){if(null!=Da||null==this){for(var Ea=document.getElementsByClassName('activeTab'),Fa=0;Fa<Ea.length;Fa++){var Ga=Ea[Fa].id.substring(4,Ea[Fa].id.length),Ha=document.getElementById('view-'+Ga);Ha.style.visibility='hidden',Ha.removeEventListener('did-finish-load',C),Ha.removeEventListener('did-frame-finish-load',C),Ha.removeEventListener('page-title-updated',D);var Ia=Ea[Fa].className.substring(0,Ea[Fa].className.length-10);Ea[Fa].className=Ia}if(null!=this){this.className+=' activeTab';var Ja=this.id.substring(4,this.id.length);document.getElementById('view-'+Ja).style.visibility='visible',currentView='view-'+Ja,Aa=ById(currentView),D()}else if(null==Da)document.getElementById('tab-'+listViews[listViews.length-1]).className+=' activeTab';else if(0==Ea.length){var Ka=listViews[listViews.length-1];document.getElementById('tab-'+Ka).className+=' activeTab',document.getElementById('view-'+Ka).style.visibility='visible',currentView='view-'+Ka,Aa=ById(currentView),D()}Aa.addEventListener('did-finish-load',C),Aa.addEventListener('did-frame-finish-load',C),Aa.addEventListener('page-title-updated',D),C()}}function h(){var Da=document.getElementById('browser-menu');Da.style.display='none'==Da.style.display?'block':'none'}function r(){var Da='';Da+=zooms[currentZoom]+'%',ia.innerHTML=Da}function y(){h();var Ea=wa.getAttribute('data-state');'closed'===Ea?(E(),xa.innerHTML='',jsonfile.readFile(bookmarks,function(Fa,Ga){if(0!==Ga.length)for(var Ha=0;Ha<Ga.length;Ha++){var Ia=Ga[Ha].url,Ja=Ga[Ha].icon,Ka=Ga[Ha].title;20<Ka.length&&(Ka=Ka.substring(0,20),Ka+=' ...');var La=new Bookmark(Ia,Ja,Ka),Ma=La.ELEMENT();xa.appendChild(Ma)}wa.style.display='block',wa.setAttribute('data-state','opened')})):(wa.style.display='none',wa.setAttribute('data-state','closed'))}function C(){document.activeElement!=T&&(matuiDir=matuiDir.split('\\').join('/'),T.value=Aa.src.includes(matuiDir)?'matui://'+Aa.src.substring(matuiDir.length,Aa.src.length-5):Aa.src),ua.innerHTML='<div class="suggestionItem" style="font-style: italic;"> Type to search or enter an address </div>'}function D(Da){var Ea;Ea=Da?Da.title:Aa.getTitle(),document.title=Ea,U.innerHTML=Ea}function E(){Ba.style.display='block'}function H(Da){var Ea=document.createElement('div');Ea.className+='suggestionItem',Ea.tabIndex=0,Ea.innerHTML=Da,Ea.addEventListener('click',J),Ea.addEventListener('keyup',J),ua.appendChild(Ea)}function I(){var Da=T.value.trim();prevSearch=Da;var Fa=require('url').parse(Da).protocol,Ga=Da.slice(0,8).toLowerCase();if(''==Da||'http:'===Fa||'https:'===Fa||'matui://'===Ga)return void(ua.innerHTML='<div class="suggestionItem" style="font-style: italic;"> Type to search or enter an address </div>');Da=encodeURIComponent(Da),ua.innerHTML='';var Ea=new XMLHttpRequest;Ea.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var Ha=JSON.parse(this.responseText);if(Ha[0])for(var Ja,Ia=0;Ia<Ha[1].length&&3>Ia;Ia++)Ja=Ha[1][Ia],H(Ja)}},Ea.open('GET',searchAPI[0]+Da,!0),Ea.send()}function J(Da){if('click'==Da.type||'keyup'==Da.type&&13==Da.keyCode){var Ea=this.innerHTML;Aa.loadURL(searchEngines[0]+Ea),ua.style.display='none',Ba.style.display='none'}else'keyup'==Da.type&&40==Da.keyCode?K('next'):'keyup'==Da.type&&38==Da.keyCode&&K('prev')}function K(){var Fa=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'next',Da=document.getElementsByClassName('suggestionItem'),Ea;for(Ea=0;Ea<Da.length&&Da[Ea]!=document.activeElement;Ea++);'next'==Fa&&++Ea<Da.length?(document.activeElement.blur(),Da[Ea].focus()):'prev'==Fa&&0<=--Ea&&(document.activeElement.blur(),Da[Ea].focus())}function L(Da){switch(h(),Da){case'bookmarks':var Ea=document.getElementById('browser-menu');Ea.style.display='none',d(matuiDir+'bookmarks.html');break;case'downloads':d(matuiDir+'downloads.html');break;case'history':d(matuiDir+'history.html');break;case'settings':d(matuiDir+'settings.html');break;case'feedback':d(matuiDir+'feedback.html');break;case'about':d(matuiDir+'about.html');break;default:d();}}var N=ById('min-btn'),O=ById('max-btn'),P=ById('close-btn'),Q=ById('menu'),R=ById('back'),S=ById('protocol'),T=ById('url'),U=ById('viewTitle'),V=ById('tabs'),W=ById('newTab'),X=ById('forward'),Y=ById('refresh'),Z=ById('home'),$=ById('fave'),_=ById('private'),aa=ById('block'),ba=ById('list'),ca=ById('downloads'),da=ById('history'),ea=ById('find'),fa=ById('print'),ga=ById('zoom-in'),ha=ById('zoom-out'),ia=ById('zoom-level'),ja=ById('fullscreen'),ka=ById('pinned'),la=ById('theme'),ma=ById('cut'),na=ById('copy'),oa=ById('paste'),pa=ById('console'),qa=ById('settings'),ra=ById('feedback'),sa=ById('about'),ta=ById('exit'),ua=ById('suggestions'),va=ById('permissions'),wa=ById('fave-popup'),xa=ById('bmarks'),ya=ById('fave-manage'),za=ById('views'),Aa=ById(currentView),Ba=ById('viewOverlay'),Ca=ById('contextMenu');d(homeURL),N.addEventListener('click',function(){var Ea=b.getCurrentWindow();Ea.minimize()}),O.addEventListener('click',function(){var Ea=b.getCurrentWindow();Ea.isMaximized()?Ea.unmaximize():Ea.maximize()}),P.addEventListener('click',c),Q.addEventListener('click',h),W.addEventListener('click',d),R.addEventListener('click',function(){Aa.goBack()}),T.addEventListener('keyup',function(Da){if(13===Da.keyCode){T.blur();var Fa=T.value.trim(),Ga=Fa.slice(0,8).toLowerCase(),Ha=Fa.slice(0,7).toLowerCase();'https://'===Ga||'http://'===Ha?Aa.loadURL(Fa):'matui://'==Ga?Aa.loadURL(matuiDir+Fa.substring(8,Fa.length)+'.html'):!Fa.includes('.')||Fa.includes(' ')?(Fa=encodeURIComponent(Fa),Aa.loadURL(searchEngines[0]+Fa)):Aa.loadURL('http://'+Fa),ua.style.display='none',Ba.style.display='none'}else if(40===Da.keyCode){T.blur();var Ea=document.getElementsByClassName('suggestionItem');0<Ea.length&&Ea[0].focus()}}),T.addEventListener('keyup',function(){clearTimeout(searchTimer),T.value.trim()!=prevSearch&&(searchTimer=setTimeout(I,500))}),U.addEventListener('click',function(){T.focus(),T.select(),ua.style.display='block',E()}),X.addEventListener('click',function(){Aa.goForward()}),Y.addEventListener('click',function(){Aa.reload()}),Z.addEventListener('click',function(){Aa.loadURL(homeURL)}),$.addEventListener('click',function(){var Da=Aa.src,Ea=Aa.getTitle();favicon(Da).then(function(Fa){var Ga=new Bookmark(Da,Fa,Ea);jsonfile.readFile(bookmarks,function(Ha,Ia){Ia.push(Ga),jsonfile.writeFile(bookmarks,Ia,function(){})})})}),ba.addEventListener('click',y),ca.addEventListener('click',function(){L('downloads')}),da.addEventListener('click',function(){L('history')}),fa.addEventListener('click',function(){Aa.print()}),ga.addEventListener('click',function(){currentZoom<zooms.length-1&&(Aa.setZoomFactor(zooms[++currentZoom]/100),r())}),ha.addEventListener('click',function(){0<currentZoom&&(Aa.setZoomFactor(zooms[--currentZoom]/100),r())}),ka.addEventListener('click',function(){var Ea=b.getCurrentWindow(),Fa=ka.getAttribute('data-state');'notPinned'===Fa?(ka.innerHTML='<i class="material-icons">radio_button_checked</i> <div class="menu-description">Unpin browser</div>',Ea.setAlwaysOnTop(!0),ka.setAttribute('data-state','isPinned')):(ka.innerHTML='<i class="material-icons">radio_button_unchecked</i> <div class="menu-description">Pin browser</div>',Ea.setAlwaysOnTop(!1),ka.setAttribute('data-state','notPinned'))}),la.addEventListener('click',function(){var Ea=la.getAttribute('data-state');'light'===Ea?(la.innerHTML='<i class="material-icons">brightness_2</i> <div class="menu-description">Dark theme</div>',document.body.className+='dark-theme',la.setAttribute('data-state','dark')):(la.innerHTML='<i class="material-icons">brightness_5</i> <div class="menu-description">Light theme</div>',document.body.className='',la.setAttribute('data-state','light'))}),ma.addEventListener('click',function(){Aa.cut()}),na.addEventListener('click',function(){Aa.copy()}),oa.addEventListener('click',function(){Aa.pasteAndMatchStyle()}),pa.addEventListener('click',function(){Aa.isDevToolsOpened()?Aa.closeDevTools():Aa.openDevTools()}),qa.addEventListener('click',function(){L('settings')}),ra.addEventListener('click',function(){L('feedback')}),sa.addEventListener('click',function(){L('about')}),ta.addEventListener('click',c),wa.addEventListener('click',function(Da){'link'===Da.target.className?(Da.preventDefault(),d(Da.target.href)):'favicon'===Da.target.className&&(Da.preventDefault(),d(Da.target.parentElement.href))}),ya.addEventListener('click',function(){L('bookmarks')}),Ba.addEventListener('click',function(){'closed'!=wa.getAttribute('data-state')&&y();var Da=document.getElementById('browser-menu');Da.style.display='none',ua.style.display='none',Ba.style.display='none'}),document.addEventListener('contextmenu',function(){console.log('open-context-menu')})}var b=require('electron').remote;document.onreadystatechange=function(){'complete'==document.readyState&&a()}}();